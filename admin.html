<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signage Pro v3.0 - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    
    <style>
        :root {
            --primary-color: #667eea;
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #06b6d4;
            --surface-color: #ffffff;
            --background-color: #f8fafc;
            --border-color: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Kanit', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* === LOGIN SYSTEM === */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-gradient);
            padding: 2rem;
        }

        .login-card {
            background: var(--surface-color);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 450px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        /* === MAIN LAYOUT === */
        .admin-layout {
            display: none;
            min-height: 100vh;
            background: var(--background-color);
        }

        .admin-layout.show {
            display: flex;
        }

        /* === SIDEBAR === */
        .sidebar {
            width: 280px;
            background: var(--surface-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--primary-gradient);
            color: white;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .nav-item {
            margin: 0.25rem 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-link:hover {
            background: #f3f4f6;
            color: var(--primary-color);
        }

        .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .nav-icon {
            font-size: 1.25rem;
            width: 20px;
            text-align: center;
        }

        /* === MAIN CONTENT === */
        .main-content {
            margin-left: 280px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .topbar {
            background: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .topbar-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        /* === CARDS AND COMPONENTS === */
        .card {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: #f9fafb;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* === FORM ELEMENTS === */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--surface-color);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* === BUTTONS === */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-error {
            background: var(--error-color);
            color: white;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* === GRID SYSTEM === */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }

        /* === TABS === */
        .tab-container {
            margin-bottom: 2rem;
        }

        .tab-list {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            position: relative;
        }

        .tab-button.active {
            color: var(--primary-color);
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* === QUICK INSERT BUTTONS === */
        .quick-insert {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .quick-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* === RICH TEXT EDITOR === */
        .editor-container {
            margin: 1rem 0;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: var(--transition);
        }

        .editor-container:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .ql-toolbar {
            border: none !important;
            border-bottom: 1px solid var(--border-color) !important;
            background: #f9fafb;
        }

        .ql-container {
            border: none !important;
            font-family: 'Kanit', sans-serif !important;
            font-size: 1rem !important;
            min-height: 200px;
        }

        .ql-editor {
            min-height: 200px;
            padding: 1.5rem;
            line-height: 1.6;
        }

        /* === BACKGROUND COLOR PICKER === */
        .bg-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .bg-color {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius);
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .bg-color:hover,
        .bg-color.active {
            border-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .bg-color.active::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 0 0 4px rgba(0,0,0,0.5);
        }

        /* === ADVERTISEMENT LIST === */
        .ad-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }

        .ad-item {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: var(--transition);
        }

        .ad-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .ad-preview {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            text-align: center;
            padding: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .ad-item-body {
            padding: 1rem;
        }

        .ad-item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .ad-item-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .ad-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .ad-item-actions .btn {
            flex: 1;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* === PREVIEW SECTION === */
        .preview-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .preview-display {
            background: var(--primary-gradient);
            border-radius: var(--border-radius);
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: var(--transition);
        }

        .preview-text {
            color: white;
            text-align: center;
            font-weight: 700;
            font-size: 1.5rem;
            line-height: 1.5;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            padding: 2rem;
        }

        .preview-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            background: var(--surface-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .preview-counter {
            background: var(--primary-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 600;
        }

        /* === SAMPLE GALLERY === */
        .sample-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .sample-item {
            aspect-ratio: 16/9;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            padding: 1rem;
        }

        .sample-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* === STATUS INDICATORS === */
        .status-indicator {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--success-color);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            transition: var(--transition);
        }

        .status-indicator.error {
            background: var(--error-color);
        }

        .status-indicator.warning {
            background: var(--warning-color);
        }

        .status-indicator.info {
            background: var(--info-color);
        }

        /* === ALERTS === */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border: 1px solid transparent;
            font-weight: 500;
            display: none;
            transition: var(--transition);
        }

        .alert.show {
            display: block;
            animation: slideInDown 0.3s ease;
        }

        .alert-success {
            background: #ecfdf5;
            color: #065f46;
            border-color: #a7f3d0;
        }

        .alert-error {
            background: #fef2f2;
            color: #991b1b;
            border-color: #fca5a5;
        }

        .alert-warning {
            background: #fffbeb;
            color: #92400e;
            border-color: #fde68a;
        }

        .alert-info {
            background: #eff6ff;
            color: #1e40af;
            border-color: #93c5fd;
        }

        /* === ANIMATIONS === */
        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* === RESPONSIVE === */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .topbar {
                padding: 1rem;
            }

            .content-area {
                padding: 1rem;
            }

            .grid-cols-3 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .grid-cols-4 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 640px) {
            .login-card {
                padding: 2rem;
                margin: 1rem;
            }

            .grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }

            .ad-item-actions {
                flex-direction: column;
            }

            .tab-list {
                flex-wrap: wrap;
            }

            .preview-controls {
                flex-direction: column;
                gap: 0.75rem;
            }

            .quick-insert {
                justify-content: center;
            }
        }

        /* === UTILITY CLASSES === */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .p-0 { padding: 0; }
        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .hidden { display: none; }
        .block { display: block; }
    </style>
</head>
<body>
    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator">
        🔄 ระบบพร้อม
    </div>

    <!-- Login Form -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-logo">🎯</div>
            <h1 class="login-title">Digital Signage Pro</h1>
            <p class="login-subtitle">v3.0 Admin Panel</p>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="username">👤 ชื่อผู้ใช้</label>
                    <input type="text" id="username" class="form-input" placeholder="กรุณาใส่ชื่อผู้ใช้" value="admin" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">🔑 รหัสผ่าน</label>
                    <input type="password" id="password" class="form-input" placeholder="กรุณาใส่รหัสผ่าน" required>
                </div>
                
                <button type="submit" class="btn btn-primary w-full">
                    🚀 เข้าสู่ระบบ
                </button>
            </form>
            
            <div class="alert alert-error" id="loginError">
                ❌ ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง
            </div>
        </div>
    </div>

    <!-- Admin Layout -->
    <div class="admin-layout" id="adminLayout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span>🎯</span>
                    <span>Digital Signage Pro</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-item">
                    <a href="#" class="nav-link active" onclick="switchTab('dashboard')" data-tab="dashboard">
                        <span class="nav-icon">📊</span>
                        <span>แดชบอร์ด</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('api')" data-tab="api">
                        <span class="nav-icon">🔑</span>
                        <span>API Configuration</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('ads')" data-tab="ads">
                        <span class="nav-icon">📢</span>
                        <span>จัดการโฆษณา</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('preview')" data-tab="preview">
                        <span class="nav-icon">👁️</span>
                        <span>ดูตัวอย่าง</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('sync')" data-tab="sync">
                        <span class="nav-icon">☁️</span>
                        <span>Cloud Sync</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('settings')" data-tab="settings">
                        <span class="nav-icon">⚙️</span>
                        <span>การตั้งค่า</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <header class="topbar">
                <h1 class="topbar-title" id="pageTitle">📊 แดชบอร์ด</h1>
                <div class="topbar-actions">
                    <button class="btn btn-secondary" onclick="openMainPage()">
                        🖥️ เปิดหน้าแสดงผล
                    </button>
                    <button class="btn btn-error" onclick="handleLogout()">
                        🚪 ออกจากระบบ
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Tab -->
                <div id="tab-dashboard" class="tab-content active">
                    <div class="grid grid-cols-4 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">📢</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);" id="totalAds">0</div>
                                <div style="color: var(--text-secondary);">โฆษณาทั้งหมด</div>
                           </div>
                       </div>
                       <div class="card">
                           <div class="card-body text-center">
                               <div style="font-size: 2rem; margin-bottom: 0.5rem;">🔄</div>
                               <div style="font-size: 1.5rem; font-weight: 700; color: var(--success-color);" id="syncCount">0</div>
                               <div style="color: var(--text-secondary);">Sync สำเร็จ</div>
                           </div>
                       </div>
                       <div class="card">
                           <div class="card-body text-center">
                               <div style="font-size: 2rem; margin-bottom: 0.5rem;">🌐</div>
                               <div style="font-size: 1.5rem; font-weight: 700; color: var(--info-color);" id="apiStatus">ออฟไลน์</div>
                               <div style="color: var(--text-secondary);">สถานะ API</div>
                           </div>
                       </div>
                       <div class="card">
                           <div class="card-body text-center">
                               <div style="font-size: 2rem; margin-bottom: 0.5rem;">⏰</div>
                               <div style="font-size: 1rem; font-weight: 700; color: var(--warning-color);" id="lastUpdate">ไม่เคย</div>
                               <div style="color: var(--text-secondary);">อัพเดทล่าสุด</div>
                           </div>
                       </div>
                   </div>

                   <div class="grid grid-cols-2">
                       <div class="card">
                           <div class="card-header">
                               <h3 class="card-title">📊 ภาพรวมระบบ</h3>
                           </div>
                           <div class="card-body">
                               <div class="mb-2">
                                   <div class="flex justify-between mb-1">
                                       <span>📱 ประสิทธิภาพระบบ</span>
                                       <span>95%</span>
                                   </div>
                                   <div style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px;">
                                       <div style="width: 95%; height: 100%; background: var(--success-color); border-radius: 4px;"></div>
                                   </div>
                               </div>
                               <div class="mb-2">
                                   <div class="flex justify-between mb-1">
                                       <span>💾 การใช้งานหน่วยความจำ</span>
                                       <span>67%</span>
                                   </div>
                                   <div style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px;">
                                       <div style="width: 67%; height: 100%; background: var(--warning-color); border-radius: 4px;"></div>
                                   </div>
                               </div>
                               <div>
                                   <div class="flex justify-between mb-1">
                                       <span>🔄 อัตราการ Sync</span>
                                       <span>89%</span>
                                   </div>
                                   <div style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px;">
                                       <div style="width: 89%; height: 100%; background: var(--info-color); border-radius: 4px;"></div>
                                   </div>
                               </div>
                           </div>
                       </div>

                       <div class="card">
                           <div class="card-header">
                               <h3 class="card-title">⚡ การดำเนินการด่วน</h3>
                           </div>
                           <div class="card-body">
                               <div class="flex flex-col gap-2">
                                   <button class="btn btn-primary" onclick="switchTab('ads')">
                                       ➕ เพิ่มโฆษณาใหม่
                                   </button>
                                   <button class="btn btn-success" onclick="testSync()">
                                       🔄 ทดสอบ Sync
                                   </button>
                                   <button class="btn btn-info" onclick="openMainPage()">
                                       👁️ ดูหน้าแสดงผล
                                   </button>
                                   <button class="btn btn-warning" onclick="exportData()">
                                       📤 ส่งออกข้อมูล
                                   </button>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>

               <!-- API Configuration Tab -->
               <div id="tab-api" class="tab-content">
                   <div class="card">
                       <div class="card-header">
                           <h3 class="card-title">🔑 IQAir API Configuration</h3>
                       </div>
                       <div class="card-body">
                           <div class="grid grid-cols-1">
                               <div class="form-group">
                                   <label class="form-label" for="apiKey">🗝️ IQAir API Key</label>
                                   <input type="password" id="apiKey" class="form-input" placeholder="กรุณาใส่ API Key จาก IQAir Dashboard">
                                   <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                       📋 รับ API Key ฟรี: <a href="https://dashboard.iqair.com/" target="_blank" style="color: var(--primary-color);">https://dashboard.iqair.com/</a>
                                   </div>
                               </div>

                               <div class="grid grid-cols-3 gap-2">
                                   <div class="form-group">
                                       <label class="form-label" for="city">🏙️ เมือง</label>
                                       <input type="text" id="city" class="form-input" placeholder="เช่น Bangkok" value="Bangkok">
                                   </div>
                                   <div class="form-group">
                                       <label class="form-label" for="state">🏛️ จังหวัด</label>
                                       <input type="text" id="state" class="form-input" placeholder="เช่น Bangkok" value="Bangkok">
                                   </div>
                                   <div class="form-group">
                                       <label class="form-label" for="country">🌍 ประเทศ</label>
                                       <select id="country" class="form-input">
                                           <option value="Thailand">Thailand</option>
                                           <option value="Singapore">Singapore</option>
                                           <option value="Malaysia">Malaysia</option>
                                           <option value="Vietnam">Vietnam</option>
                                           <option value="Philippines">Philippines</option>
                                           <option value="Indonesia">Indonesia</option>
                                       </select>
                                   </div>
                               </div>

                               <div class="flex gap-2">
                                   <button class="btn btn-primary" onclick="testApi()">
                                       🧪 ทดสอบการเชื่อมต่อ
                                   </button>
                                   <button class="btn btn-success" onclick="saveApiConfig()">
                                       💾 บันทึกการตั้งค่า
                                   </button>
                                   <button class="btn btn-secondary" onclick="toggleApiKeyVisibility()">
                                       👁️ แสดง/ซ่อน API Key
                                   </button>
                               </div>

                               <div class="alert" id="apiTestResult"></div>
                           </div>
                       </div>
                   </div>
               </div>

               <!-- Advertisement Management Tab -->
               <div id="tab-ads" class="tab-content">
                   <div class="card mb-3">
                       <div class="card-header">
                           <h3 class="card-title">➕ เพิ่มโฆษณาใหม่</h3>
                       </div>
                       <div class="card-body">
                           <div class="form-group">
                               <label class="form-label" for="adType">🎯 ประเภทโฆษณา</label>
                               <select id="adType" class="form-input" onchange="changeAdType()">
                                   <option value="text">📝 ข้อความ (Rich Text)</option>
                                   <option value="image">🖼️ รูปภาพ</option>
                                   <option value="video">🎬 วีดีโอ</option>
                               </select>
                           </div>

                           <!-- Text Form -->
                           <div id="textForm">
                               <div class="form-group">
                                   <label class="form-label">✏️ เนื้อหาโฆษณา</label>
                                   
                                   <!-- Quick Insert Buttons -->
                                   <div class="quick-insert">
                                       <button class="quick-btn" onclick="insertQuickText('business')">🏢 ธุรกิจ</button>
                                       <button class="quick-btn" onclick="insertQuickText('promotion')">🎉 โปรโมชั่น</button>
                                       <button class="quick-btn" onclick="insertQuickText('contact')">📞 ติดต่อ</button>
                                       <button class="quick-btn" onclick="insertQuickText('food')">🍕 ร้านอาหาร</button>
                                       <button class="quick-btn" onclick="insertQuickText('service')">🔧 บริการ</button>
                                       <button class="quick-btn" onclick="insertQuickText('announcement')">📢 ประกาศ</button>
                                   </div>
                                   
                                   <!-- Rich Text Editor -->
                                   <div class="editor-container">
                                       <div id="richEditor"></div>
                                   </div>
                                   
                                   <!-- Background Color Picker -->
                                   <div class="form-group">
                                       <label class="form-label">🎨 สีพื้นหลังโฆษณา</label>
                                       <div class="bg-picker">
                                           <div class="bg-color active" style="background: linear-gradient(45deg, #667eea, #764ba2)" onclick="setAdBackground('linear-gradient(45deg, #667eea, #764ba2)', this)"></div>
                                           <div class="bg-color" style="background: linear-gradient(45deg, #11998e, #38ef7d)" onclick="setAdBackground('linear-gradient(45deg, #11998e, #38ef7d)', this)"></div>
                                           <div class="bg-color" style="background: linear-gradient(45deg, #f093fb, #f5576c)" onclick="setAdBackground('linear-gradient(45deg, #f093fb, #f5576c)', this)"></div>
                                           <div class="bg-color" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4)" onclick="setAdBackground('linear-gradient(45deg, #ff6b6b, #4ecdc4)', this)"></div>
                                           <div class="bg-color" style="background: linear-gradient(45deg, #a8edea, #fed6e3)" onclick="setAdBackground('linear-gradient(45deg, #a8edea, #fed6e3)', this)"></div>
                                           <div class="bg-color" style="background: linear-gradient(45deg, #ffecd2, #fcb69f)" onclick="setAdBackground('linear-gradient(45deg, #ffecd2, #fcb69f)', this)"></div>
                                           <div class="bg-color" style="background: linear-gradient(45deg, #ff512f, #dd2476)" onclick="setAdBackground('linear-gradient(45deg, #ff512f, #dd2476)', this)"></div>
                                           <div class="bg-color" style="background: linear-gradient(45deg, #1e1e1e, #434343)" onclick="setAdBackground('linear-gradient(45deg, #1e1e1e, #434343)', this)"></div>
                                       </div>
                                   </div>
                               </div>
                           </div>

                           <!-- File Form -->
                           <div id="fileForm" class="hidden">
                               <div class="form-group">
                                   <label class="form-label" for="adFile">📁 อัพโหลดไฟล์</label>
                                   <input type="file" id="adFile" class="form-input" accept="image/*,video/*" onchange="previewFile()">
                                   <div style="background: #eff6ff; border: 1px solid #93c5fd; border-radius: 8px; padding: 1rem; margin-top: 0.5rem; font-size: 0.875rem; color: #1e40af;">
                                       📏 <strong>ขนาดไฟล์สูงสุด: 50MB</strong><br>
                                       🖼️ รองรับรูปภาพ: JPG, PNG, GIF, WebP<br>
                                       🎬 รองรับวีดีโอ: MP4, WebM, MOV
                                   </div>
                                   <div id="filePreview" class="mt-2"></div>
                               </div>
                           </div>

                           <div class="form-group">
                               <label class="form-label" for="adDuration">⏱️ ระยะเวลาแสดง (วินาที)</label>
                               <input type="number" id="adDuration" class="form-input" value="15" min="5" max="300">
                               <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                   แนะนำ: 15-30 วินาที สำหรับลิฟท์และเคาน์เตอร์
                               </div>
                           </div>

                           <div class="flex gap-2">
                               <button class="btn btn-primary" onclick="addNewAd()">
                                   ➕ เพิ่มโฆษณา
                               </button>
                               <button class="btn btn-warning" onclick="addSampleAd()">
                                   🧪 เพิ่มโฆษณาตัวอย่าง
                               </button>
                               <button class="btn btn-info" onclick="previewCurrentAd()">
                                   👁️ ดูตัวอย่าง
                               </button>
                               <button class="btn btn-secondary" onclick="resetAdForm()">
                                   🔄 รีเซ็ตฟอร์ม
                               </button>
                           </div>
                       </div>
                   </div>

                   <!-- Sample Gallery -->
                   <div class="card mb-3">
                       <div class="card-header">
                           <h3 class="card-title">🎨 เท็มเพลตโฆษณาสำเร็จรูป</h3>
                       </div>
                       <div class="card-body">
                           <div class="sample-gallery">
                               <div class="sample-item" style="background: linear-gradient(45deg, #11998e, #38ef7d)" onclick="useSampleTemplate('business')">
                                   <div>
                                       <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">🏢</div>
                                       <div><strong>ธุรกิจ</strong></div>
                                       <div style="font-size: 0.875rem; opacity: 0.9;">ชื่อร้าน + เบอร์โทร</div>
                                   </div>
                               </div>
                               <div class="sample-item" style="background: linear-gradient(45deg, #f093fb, #f5576c)" onclick="useSampleTemplate('promotion')">
                                   <div>
                                       <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">🎉</div>
                                       <div><strong>โปรโมชั่น</strong></div>
                                       <div style="font-size: 0.875rem; opacity: 0.9;">ลดราคา + จำกัดเวลา</div>
                                   </div>
                               </div>
                               <div class="sample-item" style="background: linear-gradient(45deg, #667eea, #764ba2)" onclick="useSampleTemplate('announcement')">
                                   <div>
                                       <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">📢</div>
                                       <div><strong>ประกาศ</strong></div>
                                       <div style="font-size: 0.875rem; opacity: 0.9;">ข้อมูลสำคัญ</div>
                                   </div>
                               </div>
                               <div class="sample-item" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4)" onclick="useSampleTemplate('food')">
                                   <div>
                                       <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">🍕</div>
                                       <div><strong>ร้านอาหาร</strong></div>
                                       <div style="font-size: 0.875rem; opacity: 0.9;">เมนู + เวลาเปิด</div>
                                   </div>
                               </div>
                               <div class="sample-item" style="background: linear-gradient(45deg, #a8edea, #fed6e3)" onclick="useSampleTemplate('service')">
                                   <div>
                                       <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">🔧</div>
                                       <div><strong>บริการ</strong></div>
                                       <div style="font-size: 0.875rem; opacity: 0.9;">ซ่อมแซม + ติดตั้ง</div>
                                   </div>
                               </div>
                               <div class="sample-item" style="background: linear-gradient(45deg, #ffecd2, #fcb69f)" onclick="useSampleTemplate('contact')">
                                   <div>
                                       <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">📞</div>
                                       <div><strong>ติดต่อ</strong></div>
                                       <div style="font-size: 0.875rem; opacity: 0.9;">ช่องทางต่างๆ</div>
                                   </div>
                               </div>
                           </div>
                       </div>
                   </div>

                   <!-- Advertisement List -->
                   <div class="card">
                       <div class="card-header flex justify-between items-center">
                           <h3 class="card-title">📋 รายการโฆษณา (<span id="adCount">0</span> รายการ)</h3>
                           <div class="flex gap-2">
                               <button class="btn btn-success" onclick="exportAds()">📤 ส่งออก</button>
                               <button class="btn btn-info" onclick="importAds()">📥 นำเข้า</button>
                               <button class="btn btn-warning" onclick="testSync()">🔄 ทดสอบ Sync</button>
                               <button class="btn btn-error" onclick="clearAllAds()">🗑️ ลบทั้งหมด</button>
                           </div>
                       </div>
                       <div class="card-body">
                           <div class="ad-grid" id="adGrid">
                               <!-- Advertisement items will be rendered here -->
                           </div>
                       </div>
                   </div>
               </div>

               <!-- Preview Tab -->
               <div id="tab-preview" class="tab-content">
                   <div class="card">
                       <div class="card-header">
                           <h3 class="card-title">👁️ ตัวอย่างโฆษณาปัจจุบัน</h3>
                       </div>
                       <div class="card-body">
                           <div class="preview-container">
                               <div class="preview-display" id="previewDisplay">
                                   <div class="preview-text">
                                       🌟 ยินดีต้อนรับสู่ระบบ<br>
                                       📊 Digital Signage Pro v3.0<br>
                                       ⚡ ข้อมูลคุณภาพอากาศแบบเรียลไทม์
                                   </div>
                               </div>
                               <div class="preview-controls">
                                   <button class="btn btn-secondary" onclick="prevPreview()">◀️ ก่อนหน้า</button>
                                   <span class="preview-counter" id="previewCounter">1/3</span>
                                   <button class="btn btn-secondary" onclick="nextPreview()">▶️ ถัดไป</button>
                               </div>
                           </div>
                       </div>
                   </div>

                   <div class="card">
                       <div class="card-header">
                           <h3 class="card-title">🚀 เปิดหน้าแสดงผลจริง</h3>
                       </div>
                       <div class="card-body">
                           <div class="flex gap-2">
                               <button class="btn btn-primary" onclick="openMainPage()">🖥️ เปิดในแท็บใหม่</button>
                               <button class="btn btn-info" onclick="openMainPageFullscreen()">📺 เปิดแบบเต็มจอ</button>
                               <button class="btn btn-secondary" onclick="copyMainPageUrl()">📋 คัดลอก URL</button>
                           </div>
                           
                           <div style="background: #fffbeb; border: 1px solid #fde68a; border-radius: 12px; padding: 1.5rem; margin-top: 1.5rem;">
                               <h4 style="color: #92400e; margin-bottom: 1rem;">📱 คำแนะนำการใช้งาน</h4>
                               <ul style="margin-left: 1.5rem; line-height: 1.8; color: #92400e;">
                                   <li><strong>🖥️ เปิดในแท็บใหม่:</strong> สำหรับดูตัวอย่างทั่วไป</li>
                                   <li><strong>📺 เปิดแบบเต็มจอ:</strong> สำหรับการแสดงผลจริง</li>
                                   <li><strong>📋 คัดลอก URL:</strong> สำหรับส่งให้คนอื่น</li>
                                   <li><strong>🎮 Remote Control:</strong> ← → เปลี่ยนโฆษณา | Enter รีเฟรช | Space หยุด</li>
                                   <li><strong>📱 Layout:</strong> 1=แนวนอน | 2=แนวตั้ง | 3-9=ธีมสี</li>
                               </ul>
                           </div>
                       </div>
                   </div>
               </div>

               <!-- Cloud Sync Tab -->
               <div id="tab-sync" class="tab-content">
                   <div class="card">
                       <div class="card-header">
                           <h3 class="card-title">☁️ Google Sheets Integration</h3>
                       </div>
                       <div class="card-body">
                           <div class="form-group">
                               <label class="form-label" for="sheetsUrl">📄 Google Sheets URL</label>
                               <input type="url" id="sheetsUrl" class="form-input" placeholder="https://docs.google.com/spreadsheets/d/...">
                               <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                   ใส่ URL ของ Google Sheets ที่ต้องการ sync ข้อมูล
                               </div>
                           </div>

                           <div style="background: #f3f4f6; padding: 1.5rem; border-radius: 12px; margin: 1rem 0;">
                               <h4 style="margin-bottom: 1rem;">📋 รูปแบบข้อมูลใน Google Sheets</h4>
                               <div style="font-family: monospace; font-size: 0.875rem;">
                                   <strong>Columns:</strong><br>
                                   A: Title (ชื่อโฆษณา)<br>
                                   B: Content (เนื้อหา - รองรับ HTML)<br>
                                   C: Color (สี: blue, green, pink, orange, purple, yellow, red, dark)<br>
                                   D: Duration (ระยะเวลา วินาที)<br>
                               </div>
                           </div>

                           <div class="flex gap-2">
                               <button class="btn btn-primary" onclick="setupGoogleSheets()">🔗 เชื่อมต่อ Google Sheets</button>
                               <button class="btn btn-success" onclick="syncFromSheets()">🔄 Sync ข้อมูลจาก Sheets</button>
                               <button class="btn btn-warning" onclick="testGoogleSheets()">🧪 ทดสอบการเชื่อมต่อ</button>
                           </div>

                           <div class="alert" id="sheetsStatus"></div>
                       </div>
                   </div>

                   <div class="card">
                       <div class="card-header">
                           <h3 class="card-title">🌐 Cloud Storage Sync</h3>
                       </div>
                       <div class="card-body">
                           <div class="form-group">
                               <label class="form-label" for="cloudUrl">☁️ Cloud Storage URL</label>
                               <input type="url" id="cloudUrl" class="form-input" placeholder="https://your-cloud-api.com/sync">
                               <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                   สำหรับ Firebase, Supabase หรือ API อื่นๆ
                               </div>
                           </div>

                           <div class="flex gap-2">
                               <button class="btn btn-primary" onclick="setupCloudSync()">🔗 เชื่อมต่อ Cloud</button>
                               <button class="btn btn-success" onclick="syncToCloud()">☁️ Sync ไป Cloud</button>
                               <button class="btn btn-info" onclick="syncFromCloud()">📥 Sync จาก Cloud</button>
                           </div>

                           <div class="alert" id="cloudStatus"></div>
                       </div>
                   </div>
               </div>

               <!-- Settings Tab -->
               <div id="tab-settings" class="tab-content">
                   <div class="card">
                       <div class="card-header">
                           <h3 class="card-title">⚙️ การตั้งค่าระบบ</h3>
                       </div>
                       <div class="card-body">
                           <div class="grid grid-cols-2">
                               <div class="form-group">
                                   <label class="form-label" for="updateInterval">🕐 ระยะเวลาอัพเดท AQI (นาที)</label>
                                   <input type="number" id="updateInterval" class="form-input" value="10" min="1" max="60">
                                   <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                       แนะนำ: 10-15 นาที เพื่อประหยัด API calls
                                   </div>
                               </div>
                               <div class="form-group">
                                   <label class="form-label" for="adInterval">🔄 ระยะเวลาหมุนเวียนโฆษณา (วินาที)</label>
                                   <input type="number" id="adInterval" class="form-input" value="15" min="5" max="120">
                                   <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                       แนะนำ: 15-30 วินาที สำหรับลิฟท์และเคาน์เตอร์
                                   </div>
                               </div>
                           </div>

                           <div class="form-group">
                               <label class="form-label" for="maxFileSize">📁 ขนาดไฟล์สูงสุด (MB)</label>
                               <select id="maxFileSize" class="form-input">
                                   <option value="10">10 MB - เบื้องต้น</option>
                                   <option value="25">25 MB - ปานกลาง</option>
                                   <option value="50" selected>50 MB - แนะนำ</option>
                                   <option value="100">100 MB - สูง (อาจช้า)</option>
                               </select>
                               <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                ไฟล์ใหญ่ = คุณภาพสูง แต่อาจโหลดช้าในอุปกรณ์บางรุ่น
                            </div>
                        </div>

                        <button class="btn btn-success" onclick="saveSystemSettings()">💾 บันทึกการตั้งค่า</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">💾 จัดการข้อมูล</h3>
                    </div>
                    <div class="card-body">
                        <div class="flex gap-2 mb-3">
                            <button class="btn btn-success" onclick="exportAllData()">📤 ส่งออกทั้งหมด</button>
                            <button class="btn btn-info" onclick="importAllData()">📥 นำเข้าทั้งหมด</button>
                            <button class="btn btn-warning" onclick="resetAllSettings()">🔄 รีเซ็ต</button>
                            <button class="btn btn-error" onclick="clearAllData()">🗑️ ลบทั้งหมด</button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                        </div>

                        <div style="background: #ecfdf5; border: 1px solid #a7f3d0; border-radius: 12px; padding: 1.5rem;">
                            <h4 style="color: #065f46; margin-bottom: 1rem;">ℹ️ ข้อมูลระบบ</h4>
                            <div class="grid grid-cols-2 gap-2" style="color: #065f46;">
                                <div><strong>📱 เวอร์ชัน:</strong> v3.0</div>
                                <div><strong>🛠️ สร้างเมื่อ:</strong> 7 มิ.ย. 2568</div>
                                <div><strong>🎯 เหมาะสำหรับ:</strong> ลิฟท์ & เคาน์เตอร์</div>
                                <div><strong>📺 รองรับ:</strong> Samsung TV</div>
                                <div><strong>🌐 API:</strong> IQAir Real-time</div>
                                <div><strong>☁️ Sync:</strong> Google Sheets + Cloud</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- JavaScript -->
<script>
    // === GLOBAL VARIABLES ===
    let isLoggedIn = false;
    let advertisements = [];
    let currentPreviewIndex = 0;
    let richEditor = null;
    let currentAdBackground = 'linear-gradient(45deg, #667eea, #764ba2)';
    let syncCounter = 0;
    
    const ADMIN_USER = 'admin';
    const ADMIN_PASS = 'vipart2025';
    const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB

    // Quick text templates
    const quickTextTemplates = {
        business: '🏢 <strong>ชื่อธุรกิจของคุณ</strong><br><br>📞 <strong>โทร:</strong> 02-xxx-xxxx<br><br>🏪 <strong>ที่ตั้ง:</strong> ชั้น G<br><br>⏰ <strong>เปิด:</strong> 08:00 - 20:00',
        promotion: '🎉 <strong>โปรโมชั่นพิเศษ!</strong><br><br>💰 <strong>ลดราคา 50%</strong><br><br>🛍️ สินค้าเลือกสรร<br><br>⏰ <strong>สิ้นสุด:</strong> 31 ธ.ค. 2568',
        contact: '📞 <strong>ศูนย์ข้อมูล</strong><br><br>👨‍💼 <strong>เจ้าหน้าที่ประจำ</strong><br><br>📧 info@building.com<br><br>📱 <strong>LINE:</strong> @building',
        food: '🍕 <strong>ร้านอาหารอร่อย</strong><br><br>🍜 <strong>เมนูพิเศษวันนี้</strong><br><br>📱 <strong>สั่งผ่าน LINE:</strong> @food<br><br>🚚 ส่งฟรีในอาคาร',
        service: '🔧 <strong>ศูนย์บริการช่าง</strong><br><br>⚡ <strong>ซ่อมไฟฟ้า ประปา</strong><br><br>📞 <strong>โทร:</strong> 02-xxx-xxxx<br><br>⏰ 08:00 - 18:00 น.',
        announcement: '📢 <strong>ประกาศสำคัญ</strong><br><br>🚧 <strong>ปิดซ่อมลิฟท์</strong><br><br>📅 <strong>วันที่:</strong> 15-16 มิ.ย.<br><br>🙏 ขออภัยในความไม่สะดวก'
    };

    const sampleTemplates = {
        business: {
            content: '🏢 <strong>ร้านสะดวกซื้อ 24 ชม.</strong><br><br>📞 <strong>โทร:</strong> 02-xxx-xxxx<br><br>🏪 <strong>ที่ตั้ง:</strong> ชั้น G<br><br>⏰ เปิดตลอด 24 ชั่วโมง',
            background: 'linear-gradient(45deg, #11998e, #38ef7d)'
        },
        promotion: {
            content: '🎉 <strong>โปรโมชั่นพิเศษ!</strong><br><br>💰 <strong>ลดราคา 50%</strong><br><br>🛍️ สินค้าเลือกสรร<br><br>⏰ สิ้นสุด 31 ธ.ค. 2568',
            background: 'linear-gradient(45deg, #f093fb, #f5576c)'
        },
        announcement: {
            content: '📢 <strong>ประกาศสำคัญ</strong><br><br>🚧 <strong>ปิดซ่อมลิฟท์</strong><br><br>📅 วันที่ 15-16 มิ.ย.<br><br>🙏 ขออภัยในความไม่สะดวก',
            background: 'linear-gradient(45deg, #667eea, #764ba2)'
        },
        food: {
            content: '🍕 <strong>ร้านอาหารอร่อย</strong><br><br>🍜 <strong>เมนูพิเศษวันนี้</strong><br><br>📱 สั่งผ่าน LINE: @food<br><br>🚚 ส่งฟรีในอาคาร',
            background: 'linear-gradient(45deg, #ff6b6b, #4ecdc4)'
        },
        service: {
            content: '🔧 <strong>ศูนย์บริการช่าง</strong><br><br>⚡ <strong>ซ่อมไฟฟ้า ประปา</strong><br><br>📞 โทร: 02-xxx-xxxx<br><br>⏰ 08:00 - 18:00 น.',
            background: 'linear-gradient(45deg, #a8edea, #fed6e3)'
        },
        contact: {
            content: '📞 <strong>ศูนย์ข้อมูล</strong><br><br>👨‍💼 <strong>เจ้าหน้าที่ประจำ</strong><br><br>📧 info@building.com<br><br>📱 LINE: @building',
            background: 'linear-gradient(45deg, #ffecd2, #fcb69f)'
        }
    };

    // === INITIALIZATION ===
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Digital Signage Pro v3.0 Admin Panel เริ่มต้น');
        checkLogin();
        setupEventListeners();
    });

    function checkLogin() {
        try {
            const savedLogin = localStorage.getItem('vipart_admin_login');
            const loginTime = localStorage.getItem('vipart_login_time');
            
            if (savedLogin === 'true' && loginTime) {
                const sessionTime = 24 * 60 * 60 * 1000; // 24 ชั่วโมง
                if (Date.now() - parseInt(loginTime) < sessionTime) {
                    isLoggedIn = true;
                    showAdminPanel();
                    initSystem();
                    return;
                }
            }
            showLoginForm();
        } catch (error) {
            console.error('❌ Check login error:', error);
            showLoginForm();
        }
    }

    function setupEventListeners() {
        // Login form submit
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveCurrentTab();
                        break;
                    case 'r':
                        e.preventDefault();
                        testSync();
                        break;
                    case 'p':
                        e.preventDefault();
                        openMainPage();
                        break;
                }
            }
        });
    }

    // === LOGIN SYSTEM ===
    function handleLogin(event) {
        event.preventDefault();
        
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        
        if (username === ADMIN_USER && password === ADMIN_PASS) {
            isLoggedIn = true;
            localStorage.setItem('vipart_admin_login', 'true');
            localStorage.setItem('vipart_login_time', Date.now().toString());
            
            showAdminPanel();
            initSystem();
            showAlert('success', '🎉 เข้าสู่ระบบสำเร็จ!');
        } else {
            showAlert('error', '❌ ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
        }
    }

    function handleLogout() {
        if (confirm('คุณต้องการออกจากระบบหรือไม่?')) {
            isLoggedIn = false;
            localStorage.removeItem('vipart_admin_login');
            localStorage.removeItem('vipart_login_time');
            showLoginForm();
            showAlert('success', '👋 ออกจากระบบเรียบร้อยแล้ว');
        }
    }

    function showLoginForm() {
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('adminLayout').classList.remove('show');
    }

    function showAdminPanel() {
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('adminLayout').classList.add('show');
    }

    // === SYSTEM INITIALIZATION ===
    function initSystem() {
        console.log('🎯 เริ่มต้นระบบ Admin Panel v3.0');
        
        loadSettings();
        loadAdvertisements();
        initRichTextEditor();
        updateDashboard();
        updatePreview();
        
        console.log('✅ ระบบพร้อมใช้งาน');
        updateStatusIndicator('success', '✅ ระบบพร้อม');
    }

    function loadSettings() {
        try {
            const settings = JSON.parse(localStorage.getItem('vipart_settings') || '{}');
            const location = JSON.parse(localStorage.getItem('vipart_location') || '{}');
            
            // Load API settings
            if (settings.apiKey) {
                document.getElementById('apiKey').value = settings.apiKey;
            }
            if (location.city) {
                document.getElementById('city').value = location.city;
                document.getElementById('state').value = location.state || '';
                document.getElementById('country').value = location.country || 'Thailand';
            }
            
            // Load system settings
            if (settings.updateInterval) {
                document.getElementById('updateInterval').value = settings.updateInterval;
            }
            if (settings.adInterval) {
                document.getElementById('adInterval').value = settings.adInterval;
            }
            
            console.log('⚙️ โหลดการตั้งค่าสำเร็จ');
        } catch (error) {
            console.error('❌ Load settings error:', error);
        }
    }

    function loadAdvertisements() {
        try {
            const stored = localStorage.getItem('vipart_advertisements');
            advertisements = stored ? JSON.parse(stored) : getDefaultAds();
            
            if (advertisements.length === 0) {
                advertisements = getDefaultAds();
                saveAdvertisements();
            }
            
            renderAdList();
            console.log('📢 โหลดโฆษณา:', advertisements.length, 'รายการ');
        } catch (error) {
            console.error('❌ Load ads error:', error);
            advertisements = getDefaultAds();
            saveAdvertisements();
            renderAdList();
        }
    }

    function getDefaultAds() {
        const now = Date.now();
        return [
            {
                type: 'text',
                content: '🌟 <strong>ยินดีต้อนรับสู่ระบบ</strong><br><br>📊 Digital Signage Pro v3.0<br><br>⚡ ข้อมูลคุณภาพอากาศแบบเรียลไทม์<br><br>🎯 Admin Panel ใหม่',
                background: 'linear-gradient(45deg, #667eea, #764ba2)',
                duration: 20000,
                id: now + 1
            },
            {
                type: 'text',
                content: '🏢 <strong>ชื่อธุรกิจของคุณ</strong><br><br>📞 <strong>โทร:</strong> 02-xxx-xxxx<br><br>🌟 บริการคุณภาพระดับพรีเมียม<br><br>💎 ราคาเริ่มต้น 999 บาท',
                background: 'linear-gradient(45deg, #11998e, #38ef7d)',
                duration: 18000,
                id: now + 2
            },
            {
                type: 'text',
                content: '🍕 <strong>ร้านอาหาร ชั้น G</strong><br><br>⏰ <strong>เปิด:</strong> 08:00 - 22:00<br><br>🎉 ส่วนลด 20% ทุกวันจันทร์<br><br>📱 สั่งผ่าน Food Delivery',
                background: 'linear-gradient(45deg, #f093fb, #f5576c)',
                duration: 16000,
                id: now + 3
            }
        ];
    }

    // === RICH TEXT EDITOR ===
    function initRichTextEditor() {
        try {
            const toolbarOptions = [
                ['bold', 'italic', 'underline', 'strike'],
                ['blockquote', 'code-block'],
                [{ 'header': 1 }, { 'header': 2 }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'script': 'sub'}, { 'script': 'super' }],
                [{ 'indent': '-1'}, { 'indent': '+1' }],
                [{ 'size': ['small', false, 'large', 'huge'] }],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'align': [] }],
                ['clean']
            ];

            richEditor = new Quill('#richEditor', {
                theme: 'snow',
                modules: {
                    toolbar: toolbarOptions
                },
                placeholder: 'พิมพ์เนื้อหาโฆษณาของคุณที่นี่...\n\n💡 เคล็ดลับ:\n- ใช้ปุ่ม Quick Insert เพื่อเพิ่มเท็มเพลตเร็ว\n- เลือกสีพื้นหลังด้านล่าง\n- ใส่อีโมจิ 😊 ให้น่าสนใจ'
            });

            // Auto-save draft
            richEditor.on('text-change', function() {
                try {
                    localStorage.setItem('vipart_draft_content', richEditor.root.innerHTML);
                } catch (e) {
                    console.warn('⚠️ Auto-save ไม่สำเร็จ');
                }
            });

            // Load draft
            try {
                const draftContent = localStorage.getItem('vipart_draft_content');
                if (draftContent) {
                    richEditor.root.innerHTML = draftContent;
                }
            } catch (e) {
                console.warn('⚠️ โหลด draft ไม่สำเร็จ');
            }

            console.log('✅ Rich Text Editor พร้อมใช้งาน');
        } catch (error) {
            console.error('❌ Rich Text Editor init error:', error);
            showAlert('error', 'ไม่สามารถโหลด Rich Text Editor ได้');
        }
    }

    // === TAB SYSTEM ===
    function switchTab(tabName) {
        try {
            // Update sidebar navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // Update page title
            const titles = {
                dashboard: '📊 แดชบอร์ด',
                api: '🔑 API Configuration',
                ads: '📢 จัดการโฆษณา',
                preview: '👁️ ดูตัวอย่าง',
                sync: '☁️ Cloud Sync',
                settings: '⚙️ การตั้งค่า'
            };
            document.getElementById('pageTitle').textContent = titles[tabName] || 'Admin Panel';

            // Tab-specific actions
            if (tabName === 'ads') {
                renderAdList();
            } else if (tabName === 'preview') {
                updatePreview();
            } else if (tabName === 'dashboard') {
                updateDashboard();
            }

            console.log('📂 เปลี่ยนไปแท็บ:', tabName);
        } catch (error) {
            console.error('❌ Switch tab error:', error);
        }
    }

    // === ADVERTISEMENT MANAGEMENT ===
    function changeAdType() {
        const type = document.getElementById('adType').value;
        document.getElementById('textForm').classList.toggle('hidden', type !== 'text');
        document.getElementById('fileForm').classList.toggle('hidden', type === 'text');
        
        const fileInput = document.getElementById('adFile');
        if (type === 'image') {
            fileInput.accept = 'image/*';
        } else if (type === 'video') {
            fileInput.accept = 'video/*';
        }
    }

    function insertQuickText(type) {
        if (!richEditor || !quickTextTemplates[type]) return;
        
        try {
            const template = quickTextTemplates[type];
            const range = richEditor.getSelection();
            const index = range ? range.index : richEditor.getLength();
            
            richEditor.clipboard.dangerouslyPasteHTML(index, template);
            showAlert('success', `✅ เพิ่มเท็มเพลต "${type}" สำเร็จ!`);
        } catch (error) {
            console.error('❌ Insert quick text error:', error);
            showAlert('error', 'เกิดข้อผิดพลาดในการเพิ่มเท็มเพลต');
        }
    }

    function setAdBackground(gradient, element) {
        currentAdBackground = gradient;
        
        document.querySelectorAll('.bg-color').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        
        console.log('🎨 เปลี่ยนสีพื้นหลัง:', gradient);
    }

    function useSampleTemplate(type) {
        const template = sampleTemplates[type];
        if (template && richEditor) {
            richEditor.root.innerHTML = template.content;
            currentAdBackground = template.background;
            
            // Update background picker
            document.querySelectorAll('.bg-color').forEach(el => {
                el.classList.remove('active');
                if (el.style.background === template.background) {
                    el.classList.add('active');
                }
            });
            
            showAlert('success', `✅ ใช้เท็มเพลต "${type}" สำเร็จ!`);
            switchTab('ads');
        }
    }

    function previewFile() {
        try {
            const fileInput = document.getElementById('adFile');
            const preview = document.getElementById('filePreview');
            const file = fileInput.files[0];
            
            if (file) {
                if (file.size > MAX_FILE_SIZE) {
                    const maxSizeMB = Math.round(MAX_FILE_SIZE / (1024 * 1024));
                    showAlert('error', `ไฟล์มีขนาดใหญ่เกินไป (จำกัด ${maxSizeMB}MB)`);
                    fileInput.value = '';
                    preview.innerHTML = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileSizeMB = (file.size / (1024 * 1024)).toFixed(1);
                    
                    if (file.type.startsWith('image/')) {
                        preview.innerHTML = `
                            <img src="${e.target.result}" style="max-width: 200px; max-height: 150px; margin-top: 10px; border-radius: 10px;" alt="Preview">
                            <div style="margin-top: 10px; font-size: 0.875rem; color: var(--text-secondary);">
                                📁 ${file.name}<br>
                                📏 ${fileSizeMB} MB
                            </div>
                        `;
                    } else if (file.type.startsWith('video/')) {
                        preview.innerHTML = `
                            <video src="${e.target.result}" style="max-width: 200px; max-height: 150px; margin-top: 10px; border-radius: 10px;" controls muted preload="metadata"></video>
                            <div style="margin-top: 10px; font-size: 0.875rem; color: var(--text-secondary);">
                                📁 ${file.name}<br>
                                📏 ${fileSizeMB} MB
                            </div>
                        `;
                    }
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
            }
        } catch (error) {
            console.error('❌ Preview file error:', error);
        }
    }

    function addNewAd() {
        try {
            const type = document.getElementById('adType').value;
            const duration = parseInt(document.getElementById('adDuration').value) * 1000;
            
            if (!duration || duration < 5000) {
                showAlert('error', 'ระยะเวลาแสดงต้องมากกว่า 5 วินาที');
                return;
            }
            
            let adData = {
                type,
                duration,
                id: Date.now()
            };
            
            if (type === 'text') {
                if (!richEditor) {
                    showAlert('error', 'Rich Text Editor ไม่พร้อมใช้งาน');
                    return;
                }
                
                const content = richEditor.root.innerHTML;
                if (!content.trim() || content === '<p><br></p>') {
                    showAlert('error', 'กรุณาใส่เนื้อหาโฆษณา');
                    return;
                }
                
                adData.content = content;
                adData.background = currentAdBackground;
                
                advertisements.push(adData);
                saveAdvertisements();
                resetAdForm();
                renderAdList();
                updateDashboard();
                updatePreview();
                notifyMainPage();
                showAlert('success', '✅ เพิ่มโฆษณาข้อความสำเร็จ!');
                
            } else {
                const fileInput = document.getElementById('adFile');
                
                if (!fileInput.files[0]) {
                    showAlert('error', `กรุณาเลือก${type === 'image' ? 'รูปภาพ' : 'วีดีโอ'}`);
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    adData.src = e.target.result;
                    adData.fileName = file.name;
                    adData.fileSize = Math.round(file.size / 1024) + ' KB';
                    
                    advertisements.push(adData);
                    saveAdvertisements();
                    resetAdForm();
                    renderAdList();
                    updateDashboard();
                    updatePreview();
                    notifyMainPage();
                    showAlert('success', `✅ เพิ่มโฆษณา${type === 'image' ? 'รูปภาพ' : 'วีดีโอ'}สำเร็จ!`);
                };
                
                reader.readAsDataURL(file);
            }
        } catch (error) {
            console.error('❌ Add ad error:', error);
            showAlert('error', 'เกิดข้อผิดพลาดในการเพิ่มโฆษณา');
        }
    }

    function addSampleAd() {
        const sampleAd = {
            type: 'text',
            content: `🧪 <strong>โฆษณาทดสอบ v3.0</strong><br><br>📅 สร้างเมื่อ: ${new Date().toLocaleString('th-TH')}<br><br>✨ <strong>ระบบทำงานสำเร็จ!</strong><br><br>🎯 พร้อมใช้งานจริง<br><br>🔄 Sync Counter: ${syncCounter + 1}`,
            background: 'linear-gradient(45deg, #e74c3c, #f39c12)',
            duration: 15000,
            id: Date.now()
        };
        
        advertisements.push(sampleAd);
        saveAdvertisements();
        renderAdList();
        updateDashboard();
        updatePreview();
        notifyMainPage();
        showAlert('success', '🧪 เพิ่มโฆษณาทดสอบสำเร็จ!');
    }

    function resetAdForm() {
        try {
            if (richEditor) {
                richEditor.setContents([]);
            }
            document.getElementById('adFile').value = '';
            document.getElementById('adDuration').value = '15';
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('adType').value = 'text';
            changeAdType();
            
            currentAdBackground = 'linear-gradient(45deg, #667eea, #764ba2)';
            document.querySelectorAll('.bg-color').forEach(el => el.classList.remove('active'));
            document.querySelector('.bg-color').classList.add('active');
            
            try {
                localStorage.removeItem('vipart_draft_content');
            } catch (e) {
                console.warn('⚠️ ลบ draft ไม่สำเร็จ');
            }
        } catch (error) {
            console.error('❌ Reset form error:', error);
        }
    }

    function renderAdList() {
        try {
            const adGrid = document.getElementById('adGrid');
            const adCount = document.getElementById('adCount');
            
            if (adCount) {
                adCount.textContent = advertisements.length;
            }
            
            if (advertisements.length === 0) {
                adGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary); padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">📭</div>
                        <h3 style="margin-bottom: 0.5rem;">ยังไม่มีโฆษณา</h3>
                           <p>เริ่มต้นด้วยการเพิ่มโฆษณาแรกของคุณ</p>
                       </div>
                   `;
                   return;
               }
               
               adGrid.innerHTML = advertisements.map((ad, index) => `
                   <div class="ad-item">
                       <div class="ad-preview" style="background: ${ad.background || 'linear-gradient(45deg, #667eea, #764ba2)'};">
                           ${ad.type === 'text' ? `
                               <div style="font-size: 1rem; line-height: 1.4;">${ad.content}</div>
                           ` : ad.type === 'image' ? `
                               <img src="${ad.src}" style="max-width: 100%; max-height: 100%; object-fit: cover;" alt="Ad Preview">
                           ` : `
                               <video src="${ad.src}" style="max-width: 100%; max-height: 100%; object-fit: cover;" muted></video>
                           `}
                       </div>
                       <div class="ad-item-body">
                           <div class="ad-item-title">โฆษณาที่ ${index + 1}</div>
                           <div class="ad-item-meta">
                               ประเภท: ${getAdTypeLabel(ad.type)} | ระยะเวลา: ${ad.duration/1000} วินาที
                               ${ad.fileSize ? `| ขนาด: ${ad.fileSize}` : ''}
                           </div>
                           <div class="ad-item-actions">
                               <button class="btn btn-info" onclick="previewAd(${index})">👁️ ดู</button>
                               <button class="btn btn-warning" onclick="editAd(${index})">✏️ แก้ไข</button>
                               <button class="btn btn-success" onclick="duplicateAd(${index})">📋 คัดลอก</button>
                               <button class="btn btn-error" onclick="deleteAd(${index})">🗑️ ลบ</button>
                           </div>
                       </div>
                   </div>
               `).join('');
               
           } catch (error) {
               console.error('❌ Render ad list error:', error);
           }
       }

       function getAdTypeLabel(type) {
           switch(type) {
               case 'text': return '📝 ข้อความ';
               case 'image': return '🖼️ รูปภาพ';
               case 'video': return '🎬 วีดีโอ';
               default: return '❓ ไม่ทราบ';
           }
       }

       function previewAd(index) {
           try {
               const ad = advertisements[index];
               if (!ad) return;
               
               currentPreviewIndex = index;
               updatePreview();
               switchTab('preview');
           } catch (error) {
               console.error('❌ Preview ad error:', error);
           }
       }

       function editAd(index) {
           try {
               const ad = advertisements[index];
               
               document.getElementById('adType').value = ad.type;
               document.getElementById('adDuration').value = ad.duration / 1000;
               
               changeAdType();
               
               if (ad.type === 'text' && richEditor) {
                   richEditor.root.innerHTML = ad.content;
                   currentAdBackground = ad.background;
                   
                   document.querySelectorAll('.bg-color').forEach(el => el.classList.remove('active'));
                   document.querySelectorAll('.bg-color').forEach(el => {
                       if (el.style.background === ad.background) {
                           el.classList.add('active');
                       }
                   });
               }
               
               advertisements.splice(index, 1);
               saveAdvertisements();
               renderAdList();
               updateDashboard();
               updatePreview();
               notifyMainPage();
               
               showAlert('success', '✏️ โหลดข้อมูลโฆษณาในฟอร์มแล้ว กรุณาแก้ไขและกด "เพิ่มโฆษณา"');
               switchTab('ads');
               
           } catch (error) {
               console.error('❌ Edit ad error:', error);
           }
       }

       function duplicateAd(index) {
           try {
               const originalAd = advertisements[index];
               const duplicatedAd = {
                   ...originalAd,
                   id: Date.now(),
                   content: originalAd.content ? originalAd.content.replace('</strong>', ' (สำเนา)</strong>') : originalAd.content
               };
               
               advertisements.push(duplicatedAd);
               saveAdvertisements();
               renderAdList();
               updateDashboard();
               updatePreview();
               notifyMainPage();
               showAlert('success', '📋 คัดลอกโฆษณาสำเร็จ!');
           } catch (error) {
               console.error('❌ Duplicate ad error:', error);
           }
       }

       function deleteAd(index) {
           try {
               if (confirm('🗑️ ต้องการลบโฆษณานี้หรือไม่?')) {
                   advertisements.splice(index, 1);
                   saveAdvertisements();
                   renderAdList();
                   updateDashboard();
                   updatePreview();
                   notifyMainPage();
                   showAlert('success', '🗑️ ลบโฆษณาเรียบร้อยแล้ว!');
               }
           } catch (error) {
               console.error('❌ Delete ad error:', error);
           }
       }

       function saveAdvertisements() {
           try {
               localStorage.setItem('vipart_advertisements', JSON.stringify(advertisements));
               setTimeout(() => {
                   notifyMainPage();
               }, 100);
               return true;
           } catch (error) {
               console.error('❌ Save ads error:', error);
               showAlert('error', 'เกิดข้อผิดพลาดในการบันทึกโฆษณา');
               return false;
           }
       }

       // === PREVIEW SYSTEM ===
       function updatePreview() {
           try {
               if (advertisements.length === 0) {
                   document.getElementById('previewDisplay').innerHTML = 
                       '<div class="preview-text">ยังไม่มีโฆษณา<br>กรุณาเพิ่มโฆษณาในแท็บ "จัดการโฆษณา"</div>';
                   document.getElementById('previewCounter').textContent = '0/0';
                   return;
               }
               
               if (currentPreviewIndex >= advertisements.length) {
                   currentPreviewIndex = 0;
               }
               
               const ad = advertisements[currentPreviewIndex];
               const previewDisplay = document.getElementById('previewDisplay');
               const previewCounter = document.getElementById('previewCounter');
               
               previewCounter.textContent = `${currentPreviewIndex + 1}/${advertisements.length}`;
               
               previewDisplay.style.opacity = '0.5';
               
               setTimeout(() => {
                   if (ad.type === 'text') {
                       previewDisplay.style.background = ad.background || 'linear-gradient(45deg, #667eea, #764ba2)';
                       previewDisplay.innerHTML = `<div class="preview-text">${ad.content}</div>`;
                   } else if (ad.type === 'image') {
                       previewDisplay.style.background = '#000';
                       previewDisplay.innerHTML = `<img src="${ad.src}" style="max-width: 100%; max-height: 100%; object-fit: contain;" alt="Ad Preview">`;
                   } else if (ad.type === 'video') {
                       previewDisplay.style.background = '#000';
                       previewDisplay.innerHTML = `<video src="${ad.src}" style="max-width: 100%; max-height: 100%; object-fit: contain;" controls muted></video>`;
                   }
                   
                   previewDisplay.style.opacity = '1';
               }, 300);
           } catch (error) {
               console.error('❌ Update preview error:', error);
           }
       }

       function nextPreview() {
           if (advertisements.length === 0) return;
           currentPreviewIndex = (currentPreviewIndex + 1) % advertisements.length;
           updatePreview();
       }

       function prevPreview() {
           if (advertisements.length === 0) return;
           currentPreviewIndex = currentPreviewIndex > 0 ? currentPreviewIndex - 1 : advertisements.length - 1;
           updatePreview();
       }

       // === DASHBOARD ===
       function updateDashboard() {
           try {
               document.getElementById('totalAds').textContent = advertisements.length;
               document.getElementById('syncCount').textContent = syncCounter;
               
               const settings = JSON.parse(localStorage.getItem('vipart_settings') || '{}');
               document.getElementById('apiStatus').textContent = settings.apiKey ? 'ออนไลน์' : 'ออฟไลน์';
               
               const lastUpdate = localStorage.getItem('vipart_last_update');
               if (lastUpdate) {
                   const date = new Date(parseInt(lastUpdate));
                   document.getElementById('lastUpdate').textContent = date.toLocaleString('th-TH');
               } else {
                   document.getElementById('lastUpdate').textContent = 'ไม่เคย';
               }
               
               console.log('📊 อัพเดทแดชบอร์ด');
           } catch (error) {
               console.error('❌ Update dashboard error:', error);
           }
       }

       // === API CONFIGURATION ===
       function testApi() {
           try {
               const apiKey = document.getElementById('apiKey').value.trim();
               const city = document.getElementById('city').value.trim();
               const state = document.getElementById('state').value.trim();
               const country = document.getElementById('country').value.trim();
               
               if (!apiKey) {
                   showAlert('error', '❌ กรุณาใส่ API Key');
                   return;
               }
               
               if (!city || !country) {
                   showAlert('error', '❌ กรุณาใส่ชื่อเมืองและประเทศ');
                   return;
               }
               
               showAlert('info', '🔄 กำลังทดสอบการเชื่อมต่อ API...');
               
               const url = `https://api.airvisual.com/v2/city?city=${encodeURIComponent(city)}&state=${encodeURIComponent(state || city)}&country=${encodeURIComponent(country)}&key=${apiKey}`;
               
               fetch(url, { signal: AbortSignal.timeout(15000) })
                   .then(response => {
                       if (!response.ok) {
                           throw new Error(`HTTP ${response.status}`);
                       }
                       return response.json();
                   })
                   .then(data => {
                       if (data && data.status === 'success' && data.data) {
                           const { current, city, state, country } = data.data;
                           const { pollution, weather } = current;
                           
                           showAlert('success', `
                               ✅ การเชื่อมต่อสำเร็จ!<br><br>
                               📍 สถานที่: ${city}, ${state}, ${country}<br>
                               🌬️ AQI: ${pollution.aqius}<br>
                               🌫️ PM2.5: ${pollution.pm25?.v || 'N/A'} μg/m³<br>
                               🌡️ อุณหภูมิ: ${weather.tp || 'N/A'}°C<br>
                               💧 ความชื้น: ${weather.hu || 'N/A'}%
                           `);
                       } else {
                           throw new Error('API returned invalid data');
                       }
                   })
                   .catch(error => {
                       console.error('❌ API Test error:', error);
                       let errorMsg = '❌ การทดสอบล้มเหลว<br><br>';
                       if (error.message.includes('Invalid API key')) {
                           errorMsg += 'API Key ไม่ถูกต้อง';
                       } else if (error.message.includes('call_limit_reached')) {
                           errorMsg += 'ใช้ API เกินขีดจำกัด';
                       } else if (error.message.includes('city_not_found')) {
                           errorMsg += 'ไม่พบข้อมูลสำหรับสถานที่นี้';
                       } else {
                           errorMsg += 'ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต';
                       }
                       showAlert('error', errorMsg);
                   });
                   
           } catch (error) {
               console.error('❌ Test API error:', error);
               showAlert('error', 'เกิดข้อผิดพลาดในการทดสอบ');
           }
       }

       function saveApiConfig() {
           try {
               const apiKey = document.getElementById('apiKey').value.trim();
               const city = document.getElementById('city').value.trim();
               const state = document.getElementById('state').value.trim();
               const country = document.getElementById('country').value.trim();
               
               if (!apiKey || !city || !country) {
                   showAlert('error', 'กรุณากรอกข้อมูลให้ครบถ้วน');
                   return;
               }
               
               const settings = {
                   apiKey: apiKey,
                   updateInterval: parseInt(document.getElementById('updateInterval')?.value) || 10,
                   adInterval: parseInt(document.getElementById('adInterval')?.value) || 15
               };
               
               const location = {
                   city: city,
                   state: state || city,
                   country: country
               };
               
               localStorage.setItem('vipart_settings', JSON.stringify(settings));
               localStorage.setItem('vipart_location', JSON.stringify(location));
               
               notifyMainPage();
               updateDashboard();
               showAlert('success', '💾 บันทึก API Configuration สำเร็จ!');
               
           } catch (error) {
               console.error('❌ Save API config error:', error);
               showAlert('error', 'เกิดข้อผิดพลาดในการบันทึก');
           }
       }

       function toggleApiKeyVisibility() {
           const apiKeyInput = document.getElementById('apiKey');
           if (apiKeyInput.type === 'password') {
               apiKeyInput.type = 'text';
           } else {
               apiKeyInput.type = 'password';
           }
       }

       // === SYSTEM SETTINGS ===
       function saveSystemSettings() {
           try {
               const updateInterval = parseInt(document.getElementById('updateInterval').value);
               const adInterval = parseInt(document.getElementById('adInterval').value);
               const maxFileSize = parseInt(document.getElementById('maxFileSize').value);
               
               if (updateInterval < 1 || updateInterval > 60) {
                   showAlert('error', 'ระยะเวลาอัพเดท AQI ต้องอยู่ระหว่าง 1-60 นาที');
                   return;
               }
               
               if (adInterval < 5 || adInterval > 120) {
                   showAlert('error', 'ระยะเวลาหมุนเวียนโฆษณาต้องอยู่ระหว่าง 5-120 วินาที');
                   return;
               }
               
               const settings = JSON.parse(localStorage.getItem('vipart_settings') || '{}');
               settings.updateInterval = updateInterval;
               settings.adInterval = adInterval;
               settings.maxFileSize = maxFileSize * 1024 * 1024;
               
               localStorage.setItem('vipart_settings', JSON.stringify(settings));
               
               notifyMainPage();
               updateDashboard();
               showAlert('success', '💾 บันทึกการตั้งค่าระบบสำเร็จ!');
               
           } catch (error) {
               console.error('❌ Save system settings error:', error);
               showAlert('error', 'เกิดข้อผิดพลาดในการบันทึกการตั้งค่า');
           }
       }

       // === DATA MANAGEMENT ===
       function exportAds() {
           try {
               const data = {
                   advertisements: advertisements,
                   exportDate: new Date().toISOString(),
                   version: '3.0',
                   syncCounter: syncCounter
               };
               
               const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
               const url = URL.createObjectURL(blob);
               const a = document.createElement('a');
               a.href = url;
               a.download = `vipart-ads-v3.0-${new Date().toISOString().split('T')[0]}.json`;
               a.click();
               URL.revokeObjectURL(url);
               
               showAlert('success', '📤 ส่งออกโฆษณาสำเร็จ!');
           } catch (error) {
               console.error('❌ Export ads error:', error);
               showAlert('error', 'เกิดข้อผิดพลาดในการส่งออก');
           }
       }

       function importAds() {
           document.getElementById('importFile').click();
       }

       function handleImportFile(event) {
           try {
               const file = event.target.files[0];
               if (!file) return;
               
               const reader = new FileReader();
               reader.onload = function(e) {
                   try {
                       const data = JSON.parse(e.target.result);
                       
                       if (data.advertisements && Array.isArray(data.advertisements)) {
                           if (confirm(`📥 พบโฆษณา ${data.advertisements.length} รายการ\n\nต้องการนำเข้าและแทนที่โฆษณาปัจจุบันหรือไม่?`)) {
                               advertisements = data.advertisements;
                               saveAdvertisements();
                               renderAdList();
                               updateDashboard();
                               updatePreview();
                               notifyMainPage();
                               showAlert('success', `📥 นำเข้าโฆษณา ${advertisements.length} รายการสำเร็จ!`);
                           }
                       } else {
                           showAlert('error', 'รูปแบบไฟล์ไม่ถูกต้อง');
                       }
                   } catch (error) {
                       showAlert('error', 'เกิดข้อผิดพลาดในการอ่านไฟล์');
                   }
               };
               reader.readAsText(file);
               
               event.target.value = '';
           } catch (error) {
               console.error('❌ Import file error:', error);
           }
       }

       function exportAllData() {
           try {
               const settings = JSON.parse(localStorage.getItem('vipart_settings') || '{}');
               const location = JSON.parse(localStorage.getItem('vipart_location') || '{}');
               
               const data = {
                   advertisements: advertisements,
                   settings: settings,
                   location: location,
                   exportDate: new Date().toISOString(),
                   version: '3.0',
                   syncCounter: syncCounter
               };
               
               const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
               const url = URL.createObjectURL(blob);
               const a = document.createElement('a');
               a.href = url;
               a.download = `vipart-backup-v3.0-${new Date().toISOString().split('T')[0]}.json`;
               a.click();
               URL.revokeObjectURL(url);
               
               showAlert('success', '📤 ส่งออกข้อมูลทั้งหมดสำเร็จ!');
           } catch (error) {
               console.error('❌ Export all error:', error);
               showAlert('error', 'เกิดข้อผิดพลาดในการส่งออก');
           }
       }

       function clearAllAds() {
           if (confirm('🗑️ ต้องการลบโฆษณาทั้งหมดหรือไม่?')) {
               advertisements = [];
               saveAdvertisements();
               renderAdList();
               updateDashboard();
               updatePreview();
               notifyMainPage();
               showAlert('success', '🗑️ ลบโฆษณาทั้งหมดเรียบร้อยแล้ว!');
           }
       }

       function clearAllData() {
           if (confirm('🗑️ ต้องการลบข้อมูลทั้งหมดหรือไม่?\n\nการดำเนินการนี้ไม่สามารถย้อนกลับได้!')) {
               if (confirm('⚠️ ยืนยันอีกครั้ง - ลบข้อมูลทั้งหมด?')) {
                   localStorage.removeItem('vipart_advertisements');
                   localStorage.removeItem('vipart_settings');
                   localStorage.removeItem('vipart_location');
                   localStorage.removeItem('vipart_draft_content');
                   
                   advertisements = [];
                   syncCounter = 0;
                   
                   // Reset forms
                   document.getElementById('apiKey').value = '';
                   document.getElementById('city').value = 'Bangkok';
                   document.getElementById('state').value = 'Bangkok';
                   document.getElementById('country').value = 'Thailand';
                   resetAdForm();
                   
                   renderAdList();
                   updateDashboard();
                   updatePreview();
                   notifyMainPage();
                   showAlert('success', '🗑️ ลบข้อมูลทั้งหมดเรียบร้อยแล้ว!');
               }
           }
       }

       // === SYNC SYSTEM ===
       function notifyMainPage() {
           try {
               syncCounter++;
               console.log(`📡 ส่งสัญญาณอัพเดทไปหน้าหลัก (ครั้งที่ ${syncCounter})`);
               
               const timestamp = Date.now().toString();
               
               // localStorage sync
               localStorage.setItem('vipart_force_reload', timestamp);
               localStorage.setItem('vipart_last_update', timestamp);
               
               // BroadcastChannel sync
               try {
                   if (typeof BroadcastChannel !== 'undefined') {
                       const channel = new BroadcastChannel('vipart_updates');
                       channel.postMessage({
                           type: 'admin_update',
                           action: 'force_reload',
                           advertisements: advertisements,
                           timestamp: Date.now(),
                           syncCounter: syncCounter,
                           source: 'admin_panel_v3.0'
                       });
                       channel.close();
                   }
               } catch (e) {
                   console.warn('⚠️ BroadcastChannel sync ไม่สำเร็จ');
               }
               
               updateStatusIndicator('success', `✅ Sync #${syncCounter}`);
               updateDashboard();
               
               console.log(`📡 ส่งสัญญาณครบทุกช่องทางแล้ว (Sync #${syncCounter})`);
               
           } catch (error) {
               console.error('❌ Notify main page error:', error);
               updateStatusIndicator('error', '❌ Sync Error');
           }
       }

       function testSync() {
           try {
               notifyMainPage();
               showAlert('success', '🧪 ส่งสัญญาณทดสอบแล้ว! ตรวจสอบหน้าแสดงผล');
           } catch (error) {
               console.error('❌ Test sync error:', error);
               showAlert('error', 'เกิดข้อผิดพลาดในการทดสอบ');
           }
       }

       // === MAIN PAGE FUNCTIONS ===
       function openMainPage() {
           const mainPageUrl = window.location.href.replace('admin.html', 'index.html');
           window.open(mainPageUrl, '_blank');
       }

       function openMainPageFullscreen() {
           const mainPageUrl = window.location.href.replace('admin.html', 'index.html');
           window.open(mainPageUrl, '_blank', 'fullscreen=yes,scrollbars=no,menubar=no,toolbar=no,location=no,status=no');
       }

       function copyMainPageUrl() {
           try {
               const mainPageUrl = window.location.href.replace('admin.html', 'index.html');
               navigator.clipboard.writeText(mainPageUrl).then(() => {
                   showAlert('success', '📋 คัดลอก URL เรียบร้อย!');
               }).catch(() => {
                   // Fallback for older browsers
                   const textarea = document.createElement('textarea');
                   textarea.value = mainPageUrl;
                   document.body.appendChild(textarea);
                   textarea.select();
                   document.execCommand('copy');
                   document.body.removeChild(textarea);
                   showAlert('success', '📋 คัดลอก URL เรียบร้อย!');
               });
           } catch (error) {
               console.error('❌ Copy URL error:', error);
               showAlert('error', 'ไม่สามารถคัดลอก URL ได้');
           }
       }

       // === UTILITY FUNCTIONS ===
       function showAlert(type, message) {
           try {
               console.log(`${type === 'success' ? '✅' : '❌'} Alert:`, message);
               
               const alertElement = document.createElement('div');
               alertElement.className = `alert alert-${type} show`;
               alertElement.innerHTML = message;
               
               // Insert after page title
               const contentArea = document.querySelector('.content-area');
               contentArea.insertBefore(alertElement, contentArea.firstChild);
               
               // Auto-remove
               setTimeout(() => {
                   if (alertElement.parentNode) {
                       alertElement.parentNode.removeChild(alertElement);
                   }
               }, type === 'success' ? 5000 : 8000);
               
           } catch (error) {
               console.error('❌ Show alert error:', error);
               alert(`${type === 'success' ? '✅' : '❌'} ${message}`);
           }
       }

       function updateStatusIndicator(type, message) {
           try {
               const indicator = document.getElementById('statusIndicator');
               indicator.className = `status-indicator ${type}`;
               indicator.textContent = message;
               
               setTimeout(() => {
                   indicator.textContent = '🔄 ระบบพร้อม';
                   indicator.className = 'status-indicator';
               }, 3000);
           } catch (error) {
               console.error('❌ Update status error:', error);
           }
       }

       function saveCurrentTab() {
           // Save based on current active tab
           const activeTab = document.querySelector('.nav-link.active')?.dataset.tab;
           switch (activeTab) {
               case 'api':
                   saveApiConfig();
                   break;
               case 'ads':
                   addNewAd();
                   break;
               case 'settings':
                   saveSystemSettings();
                   break;
               default:
                   testSync();
           }
       }

       // === CLOUD SYNC FUNCTIONS (Placeholder) ===
       function setupGoogleSheets() {
           showAlert('info', 'Google Sheets Sync - ฟีเจอร์นี้กำลังพัฒนา');
       }

       function syncFromSheets() {
           showAlert('info', 'Sync from Sheets - ฟีเจอร์นี้กำลังพัฒนา');
       }

       function testGoogleSheets() {
           showAlert('info', 'Test Google Sheets - ฟีเจอร์นี้กำลังพัฒนา');
       }

       function setupCloudSync() {
           showAlert('info', 'Cloud Sync Setup - ฟีเจอร์นี้กำลังพัฒนา');
       }

       function syncToCloud() {
           showAlert('info', 'Sync to Cloud - ฟีเจอร์นี้กำลังพัฒนา');
       }

       function syncFromCloud() {
           showAlert('info', 'Sync from Cloud - ฟีเจอร์นี้กำลังพัฒนา');
       }

       console.log('🎯 Digital Signage Pro v3.0 Admin Panel พร้อมใช้งาน!');
       console.log('⌨️ Keyboard shortcuts:');
       console.log('   Ctrl+S = Save current tab');
       console.log('   Ctrl+R = Test Sync');
       console.log('   Ctrl+P = Open main page');
   </script>
</body>
</html>
